<!doctype html>
<html lang="zh_CN">
  <head>
    <title>天气预报</title>
    <link rel=stylesheet type="text/css" href="style.css">
  </head>
  <body>
    <div class="main">
      <div class="line single title" id="city">载入中...</div>
      <div class="line" id="date_y"></div>
      <div class="line single" id="weather1"></div>
      <div class="line" id="wind1">风力</div>      
      <span class="halfline label">舒适度指数：</span><span class="halfline report" id='index_co'></span>
      <span class="halfline label">穿衣指数：</span><span class="halfline report" id='index'></span>
      <span class="halfline label">紫外线指数：</span><span class="halfline report" id='index_uv'></span>
      <span class="halfline label">晨练指数：</span><span class="halfline report" id='index_cl'></span>
      <span class="halfline label">洗车指数：</span><span class="halfline report" id='index_xc'></span>
      <span class="halfline label">晾晒指数：</span><span class="halfline report" id='index_ls'></span>
      <span class="halfline label">旅游指数：</span><span class="halfline report" id='index_tr'></span>
      <span class="halfline label">息斯敏过敏指数：</span><span class="halfline report" id="index_ag"></span>
      <div class="line">温馨提示：</div>
      <div class="line single" id="index_d"></div>      
    </div>
    <script>
      function renderToHtml(jt){
        var json = eval("(" + jt + ")");
        document.getElementById('city').innerHTML=json.weatherinfo.city;
        document.getElementById('date_y').innerHTML=json.weatherinfo.date_y+'&nbsp;&nbsp;'+json.weatherinfo.week;
        document.getElementById('weather1').innerHTML=json.weatherinfo.weather1+'&nbsp;&nbsp;'+json.weatherinfo.temp1;
        document.getElementById('wind1').innerHTML=json.weatherinfo.wind1+'&nbsp;&nbsp;'+json.weatherinfo.fl1;
        document.getElementById('index_co').innerHTML=json.weatherinfo.index_co;
        document.getElementById('index').innerHTML=json.weatherinfo.index;
        document.getElementById('index_uv').innerHTML=json.weatherinfo.index_uv;
        document.getElementById('index_cl').innerHTML=json.weatherinfo.index_cl;
        document.getElementById('index_xc').innerHTML=json.weatherinfo.index_xc;
        document.getElementById('index_ls').innerHTML=json.weatherinfo.index_ls;
        document.getElementById('index_tr').innerHTML=json.weatherinfo.index_tr;
        document.getElementById('index_ag').innerHTML=json.weatherinfo.index_ag;
        document.getElementById('index_d').innerHTML=json.weatherinfo.index_d;
      }

      function getwebaddress(cityid){
        return 'http://m.weather.com.cn/data/'+cityid+'.html';
      }

      var xhr = new XMLHttpRequest ();
      xhr.onreadystatechange = function () {
        if ( this.readyState == 4 )
        {
          switch ( this.status )
          {
            case 200:
            renderToHtml(xhr.responseText);
            break;
            default:
            document.getElementById('city').innerHTML='<font color="red">数据请求错误，请重试。</font>'
          }
        }
      }
      xhr.open( 'GET',getwebaddress(widget.preferences.defaultcity), false );
      xhr.send();
    </script>
  </body>
</html>
